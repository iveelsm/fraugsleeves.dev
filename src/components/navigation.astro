---
import "../styles/navigation.css";
import Search from "./search.astro";

const currentPath = Astro.url.pathname;

const navItems = [
	{ href: "/", label: "Home", exact: true },
	{ href: "/wayfinders", label: "Wayfinders", exact: false },
	{ href: "/blog", label: "Blog", exact: false },
	{ href: "/tags", label: "Tags", exact: true },
];

function isActive(href: string, exact: boolean): boolean {
	if (exact) {
		return currentPath === href;
	}
	return currentPath === href || currentPath.startsWith(href + "/");
}
---

<nav class="toolbar">
	<div class="toolbar-content">
		<a href="/" class="toolbar-logo" aria-label="Home">
			<img src="/logo.svg" alt="Logo" class="logo-image" />
		</a>

		<!-- Mobile: Search on left, Hamburger on right -->
		<div class="toolbar-mobile">
			<div class="mobile-search-wrapper">
				<Search />
			</div>
			<button
				class="hamburger-btn"
				id="hamburger-btn"
				type="button"
				aria-label="Open menu"
				aria-expanded="false"
			>
				<svg
					class="hamburger-icon"
					xmlns="http://www.w3.org/2000/svg"
					width="24"
					height="24"
					viewBox="0 0 24 24"
					fill="none"
					stroke="currentColor"
					stroke-width="2"
					stroke-linecap="round"
					stroke-linejoin="round"
				>
					<line x1="3" y1="6" x2="21" y2="6"></line>
					<line x1="3" y1="12" x2="21" y2="12"></line>
					<line x1="3" y1="18" x2="21" y2="18"></line>
				</svg>
				<svg
					class="close-icon"
					xmlns="http://www.w3.org/2000/svg"
					width="24"
					height="24"
					viewBox="0 0 24 24"
					fill="none"
					stroke="currentColor"
					stroke-width="2"
					stroke-linecap="round"
					stroke-linejoin="round"
				>
					<line x1="18" y1="6" x2="6" y2="18"></line>
					<line x1="6" y1="6" x2="18" y2="18"></line>
				</svg>
			</button>
		</div>

		<!-- Desktop: Standard navigation -->
		<div class="toolbar-right toolbar-desktop">
			<div class="toolbar-links">
				{
					navItems.map((item) => (
						<a
							href={item.href}
							class:list={[
								"toolbar-link",
								{ active: isActive(item.href, item.exact) },
							]}
						>
							{item.label}
						</a>
					))
				}
			</div>
			<Search />
		</div>
	</div>
</nav>

<!-- Mobile Navigation Overlay -->
<div class="mobile-nav-overlay" id="mobile-nav-overlay">
	<div class="mobile-nav-content">
		<nav class="mobile-nav-links">
			{
				navItems.map((item) => (
					<a
						href={item.href}
						class:list={[
							"mobile-nav-link",
							{ active: isActive(item.href, item.exact) },
						]}
					>
						{item.label}
					</a>
				))
			}
		</nav>
	</div>
</div>

<script>
	function initHamburgerMenu() {
		const hamburgerBtn = document.getElementById("hamburger-btn");
		const mobileNavOverlay = document.getElementById("mobile-nav-overlay");

		if (!hamburgerBtn || !mobileNavOverlay) return;

		hamburgerBtn.addEventListener("click", () => {
			const isOpen = mobileNavOverlay.classList.contains("active");

			if (isOpen) {
				mobileNavOverlay.classList.remove("active");
				hamburgerBtn.classList.remove("active");
				hamburgerBtn.setAttribute("aria-expanded", "false");
				document.body.style.overflow = "";
			} else {
				mobileNavOverlay.classList.add("active");
				hamburgerBtn.classList.add("active");
				hamburgerBtn.setAttribute("aria-expanded", "true");
				document.body.style.overflow = "hidden";
			}
		});

		// Close menu when clicking a link
		const mobileNavLinks =
			mobileNavOverlay.querySelectorAll(".mobile-nav-link");
		mobileNavLinks.forEach((link) => {
			link.addEventListener("click", () => {
				mobileNavOverlay.classList.remove("active");
				hamburgerBtn.classList.remove("active");
				hamburgerBtn.setAttribute("aria-expanded", "false");
				document.body.style.overflow = "";
			});
		});

		// Close menu on escape key
		document.addEventListener("keydown", (e) => {
			if (
				e.key === "Escape" &&
				mobileNavOverlay.classList.contains("active")
			) {
				mobileNavOverlay.classList.remove("active");
				hamburgerBtn.classList.remove("active");
				hamburgerBtn.setAttribute("aria-expanded", "false");
				document.body.style.overflow = "";
			}
		});
	}

	// Initialize on page load
	initHamburgerMenu();

	// Re-initialize on Astro page transitions
	document.addEventListener("astro:page-load", initHamburgerMenu);
</script>
