---
import { readFileSync } from "fs";
import { dirname, join } from "path";
import { fileURLToPath } from "url";

let fontsCss = "";

try {
	const fontsPackagePath = fileURLToPath(
		import.meta.resolve("@iveelsm/fonts/package.json"),
	);
	const fontsDir = dirname(fontsPackagePath);
	const fontsCssPath = join(fontsDir, "src", "index.css");
	const rawCss = readFileSync(fontsCssPath, "utf-8");

	fontsCss = rawCss.replace(
		/url\(["']?\.\/([^"')]+)["']?\)/g,
		(_match, relativePath) => {
			const fontPath = join(fontsDir, "src", relativePath);
			const fontData = readFileSync(fontPath);
			const base64 = fontData.toString("base64");
			const ext = relativePath.split(".").pop();
			const mimeType = ext === "woff2" ? "font/woff2" : "font/woff";
			return `url("data:${mimeType};base64,${base64}")`;
		},
	);
} catch {
	console.warn(`Package not found for custom fonts`);
}
---

{fontsCss && <style is:inline set:html={fontsCss} />}
