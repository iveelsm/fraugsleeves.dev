---
layout: ../../layouts/blog.astro
title: "How V8 works"
pubDate: 2026-03-06
shortDescription: "One of a series of posts around the inner workings of Node.js, focused on compiling JavaScript with V8."
description: "One of a series of posts around the inner-workings of Node.js, this article seeks to provide a deeper understanding of the compilation mechanisms for JavaScript. It explores monomorphism, parsing, bytecode, and optimizations and deoptimization."
author: "Mikey Sleevi"
image:
  url: "https://fraugsleeves.dev/images/v8_header.png"
  alt: "foobar"
tags: ["node.js", "compilers", "bytecode", "ast", "c++", "how-it-works"]
---

# Introduction

This article is going to be exploring a subset of the mechanisms of v8. [[1]](https://v8.dev/docs) I like to start many of my articles with a quote where I can, this one comes from Kernighan and Plauger in their book *Elements of Programming Style*.

> “Trying to outsmart a compiler defeats much of the purpose of using one.”

This quote has resonated with me for a long time. Compilers are sophisticated pieces of technology and people spend a great deal of time optimizing them. It is my full intention to tackle the concept of software compilation in more depth, but for now, I want to teach others how to outsmart one compiler. Or maybe I should say, use the compiler to it's fullest capabilities. That compiler is of course, v8. What is v8?

> V8 is Google’s open source high-performance JavaScript and WebAssembly engine, written in C++. It is used in Chrome and in Node.js, among others.

Which is to say, we are deviating from our normal C dive into C++. There have been other compilers outside of V8, and some are even still developed, like SpiderMonkey. [[2]](https://spidermonkey.dev/) But V8 is by far the most prevalant. V8 is composed of two major components.

> V8 compiles and executes JavaScript source code, handles memory allocation for objects, and garbage collects objects it no longer needs. V8’s stop-the-world, generational, accurate garbage collector is one of the keys to V8’s performance.”

Which when break that statement down we see:

1. *compiles and executes JavaScript source code*
   - This is the Compilation Pipeline, which now consists of **Turbofan** & **Ignition**
2. *handles memory allocation for objects, and garbage collects objects it no longer needs*
   - This is the Garbage Collector and Memory Management, which consists of *Orinco*

We will not be discussing garbage collection, which may be rather surprising as it's an incredibly vital part of **How v8 works**, but it would be too much to discuss in one post. We will be focused exclusively on **Turbofan** & **Ignition**, which represents the compilation pipeline in v8. That compilation pipeline can be broken down into three phases:

1. Parsing
2. Ignition & Bytecode
3. Turbofan

![TODO](../../assets/v8/pipeline.png "V8 Compilation Pipeline")

# Parsing

What is parsing? A generalized definition is:

> “Parsing, syntax analysis, or syntactic analysis is the process of analyzing a string of symbols, either in natural language, computer languages or data structures, conforming to the rules of a formal grammar”

But what does it mean in the context of v8? v8 extends upon the above definition to further clarify.

> “To run a JavaScript program, the source text needs to be processed so V8 can understand it. V8 starts out by parsing the source into an abstract syntax tree (AST), a set of objects that represent the program structure.”


```js
function foo() {
   let a = 0;
   if (a == 0) {
       let b = "bar";
       return a;
   }
}
```


```
[generating bytecode for function: foo]
--- AST ---
FUNC at 12
. KIND 0
. LITERAL ID 1
. SUSPEND COUNT 0
. NAME "foo"
. DECLS
. . VARIABLE (0x558ac855e048) (mode = LET, assigned = false) "a"
. BLOCK NOCOMPLETIONS at -1
. . EXPRESSION STATEMENT at 28
. . . INIT at 28
. . . . VAR PROXY local[0] (0x558ac855e048) (mode = LET, assigned = false) "a"
. . . . LITERAL 0
. IF at 34
. . CONDITION at 40
. . . EQ at 40
. . . . VAR PROXY local[0] (0x558ac855e048) (mode = LET, assigned = false) "a"
. . . . LITERAL 0
. . THEN at -1
. . . BLOCK at -1
. . . . BLOCK NOCOMPLETIONS at -1
. . . . . EXPRESSION STATEMENT at 63
. . . . . . INIT at 63
. . . . . . . VAR PROXY local[1] (0x558ac855e2e0) (mode = LET, assigned = false) "b"
. . . . . . . LITERAL "bar"
. . . . RETURN at 77
. . . . . VAR PROXY local[0] (0x558ac855e048) (mode = LET, assigned = false) "a"
```

## Parsing modes

## Recipes for speed

# Ignition & Bytecode

## Bytecode

```js
function helloWorld() {
 console.log("hello world");
}

helloWorld();
```


```
[generated bytecode for function:  (0x084f0824fff1 <SharedFunctionInfo>)]
Parameter count 1
Register count 3
Frame size 24
     	0x84f082500be @	0 : 12 00         	LdaConstant [0]
     	0x84f082500c0 @	2 : 26 fa         	                       Star r1
     	0x84f082500c2 @	4 : 27 fe f9      	Mov <closure>, r2
     	0x84f082500c5 @	7 : 61 39 01 fa 02	CallRuntime [DeclareGlobals], r1-r2
     	0x84f082500ca @               12 : 13 01 00      	LdaGlobal [1], [0]
     	0x84f082500cd @               15 : 26 fa         	Star r1
     	0x84f082500cf @                17 : 5c fa 02      	CallUndefinedReceiver0 r1, [2]
     	0x84f082500d2 @              20 : 26 fb         	Star r0
     	0x84f082500d4 @               22 : aa            	Return
Constant pool (size = 2)
0x84f0825008d: [FixedArray] in OldSpace
 - map: 0x084f080404b1 <Map>
 - length: 2
       	0: 0x084f0825003d <FixedArray[2]>
       	1: 0x084f0824ffc9 <String[10]: #helloWorld>
Handler Table (size = 0)
Source Position Table (size = 0)
[generated bytecode for function: helloWorld (0x084f0825004d <SharedFunctionInfo helloWorld>)]
Parameter count 1
Register count 3
Frame size 24
     	0x84f08250216 @	0 : 13 00 00      	LdaGlobal [0], [0]
     	0x84f08250219 @	3 : 26 fa         	                       Star r1
     	0x84f0825021b @	5 : 28 fa 01 02   	LdaNamedProperty r1, [1], [2]
     	0x84f0825021f @	 9 : 26 fb         	Star r0
     	0x84f08250221 @               11 : 12 02         	LdaConstant [2]
     	0x84f08250223 @              13 : 26 f9         	Star r2
     	0x84f08250225 @              15 : 59 fb fa f9 04	CallProperty1 r0, r1, r2, [4]
     	0x84f0825022a @               20 : 0d            	LdaUndefined
     	0x84f0825022b @                21 : aa            	Return
Constant pool (size = 3)
0x84f082501e1: [FixedArray] in OldSpace
 - map: 0x084f080404b1 <Map>
 - length: 3
       	0: 0x084f081c6c59 <String[7]: #console>
       	1: 0x084f081c6ccd <String[3]: #log>
       	2: 0x084f08250199 <String[11]: #hello world>
```


## Exploring Ignition

# Turbofan

```js
function helloWorld() {
 console.log("hello world");
}

helloWorld();
```


```
--- Optimized code ---
optimization_id = 0
source_position = 0
kind = OPTIMIZED_FUNCTION
stack_slots = 5
compiler = turbofan
address = 0x13800082ae1

Instructions (size = 228)
0x13800082b20 	0  488d1df9ffffff REX.W leaq rbx,[rip+0xfffffff9]
0x13800082b27 	7  483bd9     	REX.W cmpq rbx,rcx
0x13800082b2a 	a  7418       	jz 0x13800082b44  <+0x24>
0x13800082b2c 	c  48ba6800000000000000 REX.W movq rdx,0x68
0x13800082b36	16  49baa0bcb8624e560000 REX.W movq r10,0x564e62b8bca0  (Abort)	;; off heap target
0x13800082b40	20  41ffd2     	call r10
0x13800082b43	23  cc         	int3l
0x13800082b44	24  8b59d0     	movl rbx,[rcx-0x30]
0x13800082b47	27  4903dd     	REX.W addq rbx,r13
0x13800082b4a	2a  f6430701   	testb [rbx+0x7],0x1
0x13800082b4e	2e  740d       	jz 0x13800082b5d  <+0x3d>
0x13800082b50	30  49ba608cae624e560000 REX.W movq r10,0x564e62ae8c60  (CompileLazyDeoptimizedCode)	;; off heap target
0x13800082b5a	3a  41ffe2     	jmp r10
0x13800082b5d	3d  55         	push rbp
0x13800082b5e	3e  4889e5     	REX.W movq rbp,rsp
0x13800082b61	41  56         	push rsi
0x13800082b62	42  57         	push rdi
0x13800082b63	43  4883ec08   	REX.W subq rsp,0x8
0x13800082b67	47  488975e8   	REX.W movq [rbp-0x18],rsi
0x13800082b6b	4b  493b6560   	REX.W cmpq rsp,[r13+0x60] (external value (StackGuard::address_of_jslimit()))
0x13800082b6f	4f  0f8644000000   jna 0x13800082bb9  <+0x99>
0x13800082b75	55  48ba3d00250838010000 REX.W movq rdx,0x1380825003d	;; object: 0x01380825003d <FixedArray[2]>
0x13800082b7f	5f  52         	push rdx
0x13800082b80	60  48bad500250838010000 REX.W movq rdx,0x138082500d5	;; object: 0x0138082500d5 <JSFunction (sfi = 0x1380824fff1)>
0x13800082b8a	6a  52         	push rdx
0x13800082b8b	6b  48bb702d2c624e560000 REX.W movq rbx,0x564e622c2d70	;; external reference (Runtime::DeclareGlobals)
0x13800082b95	75  b802000000 	movl rax,0x2
...
```

## Building feedback

## Optimization and deoptimization

### Monomorphism

### Inline caching

## Performance

# Summary


# References

1. https://v8.dev/docs
2. https://spidermonkey.dev/


1. https://www.youtube.com/watch?v=PsDqH_RKvyc
2. https://v8.dev/docs
3. https://doar-e.github.io/blog/2019/01/28/introduction-to-turbofan/#compilation-pipeline
4. https://docs.google.com/presentation/d/1H1lLsbclvzyOF3IUR05ZUaZcqDxo7_-8f4yJoxdMooU/edit#slide=id.g18ceb14729_0_48
5. https://blog.logrocket.com/how-javascript-works-optimizing-the-v8-compiler-for-efficiency/
6. https://ponyfoo.com/articles/an-introduction-to-speculative-optimization-in-v8
7. https://en.wikipedia.org/wiki/Parsing#Computer_languages
8. https://www.youtube.com/watch?v=Fg7niTmNNLg
9. https://v8.dev/blog/scanner
10. https://v8.dev/blog/lazy-unlinking
11. https://www.youtube.com/watch?v=u7zRSm8jzvA
12. https://aerotwist.com/blog/when-everything-is-important-nothing-is/
13. https://blog.chromium.org/2015/03/new-javascript-techniques-for-rapid.html
14. https://web.dev/apply-instant-loading-with-prpl/
15. https://docs.google.com/presentation/d/1Lq2DD28CGa7bxawVH_2OcmyiTiBn74dvC6vn2essroY/edit#slide=id.g1a504e63c9_2_89
16. https://v8.dev/blog/cost-of-javascript-2019
17. https://www.youtube.com/watch?v=cvybnv79Sek
18. https://mrale.ph/blog/2015/01/11/whats-up-with-monomorphism.html
19. https://mrale.ph/blog/2012/06/03/explaining-js-vms-in-js-inline-caches.html
20. https://mrale.ph/s3/webrebels2012.pdf
21. https://v8.dev/docs/ignition
22. https://medium.com/dailyjs/understanding-v8s-bytecode-317d46c94775
23. https://www.youtube.com/watch?v=p-iiEDtpy6I
24. https://docs.google.com/presentation/d/1OqjVqRhtwlKeKfvMdX6HaCIu9wpZsrzqpIVIwQSuiXQ/edit#slide=id.g1357e6d1a4_0_58
25. https://blog.sessionstack.com/how-javascript-works-parsing-abstract-syntax-trees-asts-5-tips-on-how-to-minimize-parse-time-abfcf7e8a0c8
26. https://www.jfokus.se/jfokus18/preso/Escape-Analysis-in-V8.pdf
27. https://v8.dev/docs/turbofan
28. https://channel9.msdn.com/Shows/Going+Deep/Expert-to-Expert-Erik-Meijer-and-Lars-Bak-Inside-V8-A-Javascript-Virtual-Machine
29. https://www.mattzeunert.com/2017/01/30/lazy-javascript-parsing-in-v8.html
30. https://docs.google.com/document/d/11T2CRex9hXxoJwbYqVQ32yIPMh0uouUZLdyrtmMoL44/edit?ts=56f27d9d#heading=h.6jz9dj3bnr8t
